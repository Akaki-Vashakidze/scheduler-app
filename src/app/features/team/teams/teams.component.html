<div class="teams-container">
    <div class="teams-header">
        <div>
            <h1>My Teams</h1>
            <p class="subtitle">You are a leader of {{ myTeams.length }} teams</p>
        </div>
        <button class="create-btn" (click)="openCreateTeamNav()">
            + New Team
        </button>
    </div>

    <div class="teams-grid" *ngIf="myTeams.length > 0">
        <div class="team-card" *ngFor="let team of myTeams; let i = index">
            <div class="card-content">
                <div class="team-badge">Team</div>
                <h2 class="team-title">{{ team.title || 'General Team' }}</h2>

                <div class="team-stats">
                    <div class="stat">
                        <span class="label">Leader:</span>
                        <span class="value">{{ team.leader.name }} {{ team.leader.surname }}</span>
                    </div>
                    <div class="stat">
                        <span class="label">Members:</span>
                        <span class="value">{{ team.members.length + 1 || 0 }}</span>
                    </div>
                    <div class="stat">
                        <span class="label">Created:</span>
                        <span class="value">{{ team.createdAt | date:'mediumDate' }}</span>
                    </div>
                </div>
            </div>

            <div class="card-actions">
                <button *ngIf="membersDisplayed !== (i + 1)" (click)="membersDisplayed = (i + 1)"
                    class="action-btn view">Manage
                    Members</button>
                <button *ngIf="membersDisplayed === (i + 1)" (click)="hideMembers()"
                    class="action-btn view">Hide
                    Members</button>
            </div>

            <div class="members" *ngIf="membersDisplayed === (i + 1)">
                <h3>Members</h3>
                <div class="member-list">
                    <div class="member" *ngFor="let member of team.members | slice:0:3">
                        <div>{{ member.name }} {{ member.surname }}</div>

                        <div class="member-actions">
                            <div [matMenuTriggerFor]="memberMenu" aria-label="Member actions">
                                <mat-icon>more_vert</mat-icon>
                            </div>

                            <mat-menu #memberMenu="matMenu">
                                <button mat-menu-item (click)="giveLeaderPosition(team._id, member._id)">
                                    <mat-icon>person</mat-icon>
                                    <span>Make leader</span>
                                </button>

                                <button mat-menu-item (click)="removeMemberFromMyTeam(team._id, member._id)">
                                    <mat-icon color="warn">delete</mat-icon>
                                    <span>Remove member</span>
                                </button>
                            </mat-menu>
                        </div>
                    </div>
                </div>

                <button (click)="toggleAddMembers()" class="action-btn view">Add Member</button>
            </div>

            <div class="add-members" *ngIf="AddMembersDisplayed === (i + 1)">
                <app-add-team-members [teamMembers]="team.members" [teamLeader]="team.leader" [teamId]="team._id" (closeAddMembers)="AddMembersDisplayed = false"
                (membersUpdated)="getMyTeams()"></app-add-team-members>
        </div>
    </div>

    <ng-template #noTeams>
        <div class="empty-state">
            <p>No teams found. Start by creating your first team.</p>
        </div>
    </ng-template>
</div>